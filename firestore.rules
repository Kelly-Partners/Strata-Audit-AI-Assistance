rules_version = '2';

// Strata Audit AI – Firestore 安全规则（等效参考项目 SERVICES_INVENTORY 描述）
// 参考项目不可直接访问时按本 App 的 Plan/用户数据模型编写。
service cloud.firestore {
  match /databases/{database}/documents {

    // 用户自身文档：仅本人可读写
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // 审计计划：仅创建者（userId/createdBy）可读写
    match /plans/{planId} {
      allow read, write: if request.auth != null
        && (resource == null
          ? request.resource.data.get('userId', '') == request.auth.uid
          : resource.data.get('userId', '') == request.auth.uid);
    }

    // 未匹配的路径默认拒绝（可根据需要增加更多集合）
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
